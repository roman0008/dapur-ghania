<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dapur Ghania - Premium Homemade Catering</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200;400;600;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK (Compatibility Version) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        :root {
            --primary: #3E2723;
            --accent: #D4AF37;
        }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fdfaf7; color: var(--primary); }
        .font-serif { font-family: 'Playfair Display', serif; }
        .glass-effect { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); }
        
        .modal-container {
            position: fixed; inset: 0; display: none; align-items: center; justify-content: center;
            background-color: rgba(62, 39, 35, 0.5); backdrop-filter: blur(4px); z-index: 9999; padding: 1rem;
        }
        .modal-container.active { display: flex; }
        .modal-content {
            background: white; width: 100%; max-width: 420px; border-radius: 2.5rem;
            padding: 2.5rem; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalPop 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        @keyframes modalPop { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .input-minimal {
            @apply w-full p-4 bg-gray-50 border border-gray-100 rounded-2xl text-sm focus:bg-white focus:ring-1 focus:ring-[#D4AF37] outline-none transition-all font-medium;
        }
        .btn-primary {
            @apply bg-[#3E2723] text-white py-4 rounded-2xl font-bold text-[11px] uppercase tracking-[0.2em] active:scale-[0.98] transition-all;
        }
    </style>
</head>
<body class="selection:bg-orange-100">

    <!-- Header -->
    <header class="glass-effect sticky top-0 z-50 border-b border-orange-50">
        <div class="max-w-6xl mx-auto px-6 py-4 flex justify-between items-center">
            <div onclick="navigateTo('home')" class="cursor-pointer">
                <h1 class="text-xl font-serif font-bold text-[#3E2723] tracking-tight">Dapur Ghania</h1>
                <p class="text-[8px] text-[#D4AF37] font-bold uppercase tracking-[0.3em]">Artisan Bakery</p>
            </div>
            
            <div class="flex items-center gap-4">
                <div id="auth-ui">
                    <button id="login-btn" onclick="openAuthModal()" class="text-[10px] font-bold uppercase tracking-widest px-5 py-2.5 border border-[#D4AF37] text-[#D4AF37] rounded-full hover:bg-[#D4AF37] hover:text-white transition-all">
                        Login
                    </button>
                    <div id="user-profile" class="hidden flex items-center gap-3 cursor-pointer" onclick="openLogoutModal()">
                        <div class="text-right hidden sm:block">
                            <p id="user-name-display" class="text-[10px] font-bold text-[#3E2723] uppercase tracking-tight"></p>
                            <p class="text-[8px] text-[#D4AF37] uppercase font-bold">Premium Member</p>
                        </div>
                        <img id="user-img" class="w-9 h-9 rounded-full border-2 border-[#D4AF37]/20 shadow-sm" src="" alt="User">
                    </div>
                </div>

                <button onclick="toggleCart()" class="relative p-2.5 bg-white rounded-full shadow-sm border border-orange-50">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-[#D4AF37] text-white text-[9px] font-bold min-w-[18px] h-[18px] flex items-center justify-center rounded-full border-2 border-white">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="page-home" class="max-w-6xl mx-auto p-6 md:p-12">
        <section class="text-center mb-16 py-12">
            <h2 class="text-[10px] font-bold uppercase tracking-[0.5em] text-[#D4AF37] mb-4">The Art of Premium Baking</h2>
            <h1 class="text-4xl md:text-6xl font-serif text-[#3E2723] mb-6 leading-tight">Lezatnya Kebahagiaan di Setiap Gigitan</h1>
            <p class="text-sm text-gray-500 max-w-xl mx-auto mb-10">Setiap pesanan dibuat secara artisan dengan bahan premium pilihan.</p>
        </section>

        <div id="product-list" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            <!-- Produk di-render di sini -->
        </div>
    </main>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-container">
        <div class="modal-content relative">
            <button onclick="closeAuthModal()" class="absolute top-6 right-6 text-gray-300 hover:text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
            
            <div class="flex gap-6 mb-8 border-b border-gray-100">
                <button id="tab-login" onclick="switchAuthTab('login')" class="text-xs font-bold border-b-2 border-[#3E2723] pb-3 transition-all">MASUK</button>
                <button id="tab-register" onclick="switchAuthTab('register')" class="text-xs font-bold text-gray-300 border-b-2 border-transparent pb-3 transition-all">DAFTAR</button>
            </div>

            <div id="form-login" class="space-y-4">
                <input type="email" id="login-email" placeholder="Alamat Email" class="input-minimal">
                <input type="password" id="login-password" placeholder="Password" class="input-minimal">
                <button onclick="handleEmailLogin()" class="btn-primary w-full shadow-lg shadow-[#3E2723]/20 mt-2">Masuk Akun</button>
                
                <div class="relative py-4">
                    <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-100"></div></div>
                    <div class="relative flex justify-center text-[10px] uppercase font-bold text-gray-300"><span class="bg-white px-2">Atau</span></div>
                </div>

                <button onclick="handleGoogleLogin()" class="w-full py-4 border border-gray-100 rounded-2xl flex items-center justify-center gap-3 text-[10px] font-bold uppercase tracking-widest hover:bg-gray-50 transition-all">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" class="w-4 h-4"> Google Login
                </button>
            </div>

            <div id="form-register" class="space-y-4 hidden">
                <input type="text" id="reg-name" placeholder="Nama Lengkap" class="input-minimal">
                <input type="email" id="reg-email" placeholder="Email Baru" class="input-minimal">
                <input type="password" id="reg-password" placeholder="Buat Password" class="input-minimal">
                <button onclick="handleEmailRegister()" class="btn-primary w-full">Daftar Sekarang</button>
            </div>
        </div>
    </div>

    <!-- Logout Confirmation -->
    <div id="logout-modal" class="modal-container">
        <div class="modal-content text-center">
            <div class="w-20 h-20 bg-orange-50 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="text-3xl">ðŸ‘‹</span>
            </div>
            <h2 class="text-xl font-serif font-bold mb-2">Ingin Keluar?</h2>
            <p class="text-xs text-gray-400 mb-8">Anda akan keluar dari akun Dapur Ghania.</p>
            <div class="flex flex-col gap-3">
                <button onclick="processLogout()" class="btn-primary w-full">Ya, Keluar</button>
                <button onclick="closeLogoutModal()" class="text-[10px] font-bold uppercase tracking-widest text-gray-300 py-2">Batal</button>
            </div>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-[#3E2723] text-white px-6 py-3 rounded-full text-[10px] font-bold uppercase tracking-widest shadow-2xl z-[10000] hidden"></div>

    <script>
        // --- CONFIGURATION ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycby_KG2xz-bDztuIw1gBhcKqfK2LjPZbm_SZbQsUwcvc5X-GDPTCTTSDDlVpPOyZ0K4bKw/exec";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCgzjHOF5qTfevqRAMNdpLl5oPzrb02onM",
            authDomain: "dapur-ghania.firebaseapp.com",
            projectId: "dapur-ghania",
            storageBucket: "dapur-ghania.firebasestorage.app",
            messagingSenderId: "745922887760",
            appId: "1:745922887760:web:41c5cf27ed90bb403f9155"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        let currentUser = null;

        const products = [
            { id: 1, name: "Snack Box Premium", price: 35000, img: "https://images.unsplash.com/photo-1558326567-98ae2405596b?w=400" },
            { id: 2, name: "Pudding Art Bloom", price: 175000, img: "https://images.unsplash.com/photo-1551024506-0bccd828d307?w=400" },
            { id: 3, name: "Artisan Risol Mayo", price: 8500, img: "https://images.unsplash.com/photo-1541592106381-b31e9677c0e5?w=400" },
            { id: 4, name: "Lapis Legit Wisman", price: 450000, img: "https://images.unsplash.com/photo-1582234372722-50d7ccc30eb3?w=400" }
        ];

        // --- AUTH LOGIC ---
        auth.onAuthStateChanged((user) => {
            currentUser = user;
            const loginBtn = document.getElementById('login-btn');
            const userProfile = document.getElementById('user-profile');
            const userNameDisp = document.getElementById('user-name-display');
            const userImg = document.getElementById('user-img');

            if (user && !user.isAnonymous) {
                loginBtn.classList.add('hidden');
                userProfile.classList.remove('hidden');
                userNameDisp.innerText = user.displayName || user.email.split('@')[0];
                userImg.src = user.photoURL || `https://ui-avatars.com/api/?name=${user.displayName || user.email}&background=3E2723&color=fff`;
                syncUserData(user);
                closeAuthModal();
            } else {
                loginBtn.classList.remove('hidden');
                userProfile.classList.add('hidden');
            }
        });

        async function handleEmailLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            if(!email || !pass) return showToast("Isi email & password!");
            
            try {
                await auth.signInWithEmailAndPassword(email, pass);
                showToast("Berhasil Masuk!");
            } catch (err) {
                showToast("Gagal: " + err.message);
            }
        }

        async function handleEmailRegister() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-password').value;
            if(!name || !email || !pass) return showToast("Lengkapi data!");

            try {
                const cred = await auth.createUserWithEmailAndPassword(email, pass);
                await cred.user.updateProfile({ displayName: name });
                showToast("Akun Berhasil Dibuat!");
            } catch (err) {
                showToast("Gagal: " + err.message);
            }
        }

        async function handleGoogleLogin() {
            const provider = new firebase.auth.GoogleAuthProvider();
            try {
                await auth.signInWithPopup(provider);
                showToast("Login Google Berhasil!");
            } catch (err) {
                showToast("Gagal Google Login");
            }
        }

        async function processLogout() {
            await auth.signOut();
            closeLogoutModal();
            showToast("Sampai Jumpa Lagi!");
        }

        async function syncUserData(user) {
            if (!SCRIPT_URL) return;
            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({
                        action: 'sync_user',
                        uid: user.uid,
                        name: user.displayName || user.email,
                        email: user.email,
                        photo: user.photoURL || ""
                    })
                });
            } catch (e) {}
        }

        // --- UI UTILS ---
        function renderProducts() {
            const list = document.getElementById('product-list');
            list.innerHTML = products.map(p => `
                <div class="bg-white rounded-[2rem] overflow-hidden border border-orange-50 shadow-sm group">
                    <div class="aspect-square overflow-hidden bg-gray-50">
                        <img src="${p.img}" class="w-full h-full object-cover group-hover:scale-110 transition-all duration-700">
                    </div>
                    <div class="p-6">
                        <h4 class="text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-1">${p.name}</h4>
                        <p class="text-sm font-bold text-[#3E2723] mb-4">Rp ${p.price.toLocaleString()}</p>
                        <button class="w-full py-3 bg-gray-50 text-[#3E2723] rounded-xl text-[9px] font-black uppercase tracking-widest hover:bg-[#3E2723] hover:text-white transition-all">Tambah</button>
                    </div>
                </div>
            `).join('');
        }

        window.openAuthModal = () => document.getElementById('auth-modal').classList.add('active');
        window.closeAuthModal = () => document.getElementById('auth-modal').classList.remove('active');
        window.openLogoutModal = () => document.getElementById('logout-modal').classList.add('active');
        window.closeLogoutModal = () => document.getElementById('logout-modal').classList.remove('active');

        window.switchAuthTab = (tab) => {
            const isLogin = tab === 'login';
            document.getElementById('form-login').classList.toggle('hidden', !isLogin);
            document.getElementById('form-register').classList.toggle('hidden', isLogin);
            document.getElementById('tab-login').style.borderColor = isLogin ? '#3E2723' : 'transparent';
            document.getElementById('tab-login').style.color = isLogin ? '#3E2723' : '#D1D5DB';
            document.getElementById('tab-register').style.borderColor = !isLogin ? '#3E2723' : 'transparent';
            document.getElementById('tab-register').style.color = !isLogin ? '#3E2723' : '#D1D5DB';
        }

        window.showToast = (msg) => {
            const t = document.getElementById('toast');
            t.innerText = msg;
            t.classList.remove('hidden');
            setTimeout(() => t.classList.add('hidden'), 3000);
        }

        // Init
        window.onload = renderProducts;
    </script>
</body>
</html>
